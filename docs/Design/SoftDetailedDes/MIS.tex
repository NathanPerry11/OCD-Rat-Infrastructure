\documentclass[12pt, titlepage]{article}

\usepackage{amsmath, mathtools}

\usepackage[round]{natbib}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{colortbl}
\usepackage{xr}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{xfrac}
\usepackage{tabularx}
\usepackage{float}
\usepackage{siunitx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage[section]{placeins}
\usepackage{caption}
\usepackage{fullpage}

\hypersetup{
bookmarks=true,     % show bookmarks bar?
colorlinks=true,       % false: boxed links; true: colored links
linkcolor=red,          % color of internal links (change box color with linkbordercolor)
citecolor=blue,      % color of links to bibliography
filecolor=magenta,  % color of file links
urlcolor=cyan          % color of external links
}

\usepackage{array}

\externaldocument{../../SRS/SRS}

\input{../../Comments}
\input{../../Common}

\begin{document}

\title{Module Interface Specification for \progname{}}

\author{\authname}

\date{\today}

\maketitle

\pagenumbering{roman}

\section{Revision History}

\begin{tabularx}{\textwidth}{p{3cm}p{2cm}X}
\toprule {\bf Date} & {\bf Version} & {\bf Notes}\\
\midrule
Date 1 & 1.0 & Notes\\
Date 2 & 1.1 & Notes\\
\bottomrule
\end{tabularx}

~\newpage

\section{Symbols, Abbreviations and Acronyms}

See SRS Documentation at \url{https://github.com/OCD-Rats-Capstone/OCD-Rat-Infrastructure/blob/main/docs/SRS-Volere/SRS.pdf}

\wss{Also add any additional symbols, abbreviations or acronyms}

\newpage

\tableofcontents

\newpage

\pagenumbering{arabic}

\section{Introduction}

The following document details the Module Interface Specifications for
\textbf{RatBat2}, a data analysis web application designed to visualize, query, and process behavioural data from experiments involving rats with Obsessive-Compulsive Disorder (OCD). The system enables researchers to upload experimental trial data, perform natural language–based searches, and generate dynamic visualizations for behavioural comparisons and trend analysis.

Complementary documents include the \textit{System Requirements Specification (SRS)} and \textit{Module Guide (MG)}.  
The full documentation and implementation can be found at  
\url{https://github.com/OCD-Rats-Capstone/OCD-Rat-Infrastructure}.


\section{Notation}

This document adopts a formal notation and structural convention to describe the architecture and module interface specifications (MIS) for the Behavioral Data Analysis Platform for Animal Models of OCD. 

The structure of each MIS follows the framework of \citet{HoffmanAndStrooper1995}, extended to incorporate template modules as described by \citet{GhezziEtAl2003}. The mathematical and logical notation is consistent with Chapter 3 of \citet{HoffmanAndStrooper1995}, with domain-specific adaptations for data processing and behavioral event analysis.

\subsection*{Mathematical and Logical Conventions}

\begin{itemize}
    \item The symbol \texttt{:=} denotes an assignment or multiple assignment statement.  
    For example, \texttt{session.avg\_latency := sum(latency) / count(latency)}.

    \item Conditional expressions follow the form:
    \[
        (c_1 \Rightarrow r_1 \;|\; c_2 \Rightarrow r_2 \;|\; \dots \;|\; c_n \Rightarrow r_n)
    \]
    For instance:
    \[
        (\text{event.type = "drug 1"} \Rightarrow \text{increment(count)} \;|\; \text{event.type = "drug 2"} \Rightarrow \text{record(duration)})
    \]
    where the rule corresponding to the first true condition is applied.

    \item Logical connectives are used as follows:
    \begin{itemize}
        \item \(\land\) — logical AND  
        \item \(\lor\) — logical OR  
        \item ` — logical NOT  
        \item \(\Rightarrow\) — implication
    \end{itemize}

    \item Set notation follows standard mathematical conventions:  
    \(\{x \mid P(x)\}\) represents the set of all \(x\) satisfying predicate \(P(x)\).  
    Example:  
    \(\{ e \in Events \mid e.duration > 10s \}\) denotes the set of long-duration events.

    \item Ranges are denoted as \([a..b]\), representing all integer time indices \(t\) such that \(a \leq t \leq b\).

    \item Function definitions are expressed as mappings:  
    \[
        f : Input \rightarrow Output
    \]
    Example:  
    \[
        \texttt{computeMetrics} : SessionData \rightarrow BehavioralSummary
    \]
\end{itemize}

\subsection*{Data and Type Notation}

\begin{itemize}
    \item \(Session\) — a structured dataset representing a single experimental trial.  
    \item \(Event\) — a tuple of attributes describing a behavioral observation, e.g. \((type, timestamp, duration)\).
    \item \(Metric\) — a computed quantitative value derived from one or more events.
    \item \(AnimalID\) — a unique identifier for a subject.
    \item \(TrialSet := \{ s_1, s_2, ..., s_n \}\) — the set of all sessions recorded for a given animal.
\end{itemize}

\subsection*{Units and Measurement Conventions}
\begin{itemize}
    \item Time values are expressed in seconds (s).  
    \item Counts and frequencies are represented as integers.  
    \item Statistical metrics (e.g., mean, standard deviation, z-score) are expressed as real numbers (\(\mathbb{R}\)).
\end{itemize}

These conventions are used consistently throughout the system specification to ensure mathematical clarity and facilitate unambiguous interpretation of the behavioral data models, algorithms, and transformations.


\section{Module Decomposition}

The following table is taken directly from the Module Guide document for this project.

\begin{table}[h!]
  \centering
  \begin{tabular}{p{0.3\textwidth} p{0.6\textwidth}}
  \toprule
  \textbf{Level 1} & \textbf{Level 2}\\
  \midrule
  
  {Hardware-Hiding Module} & ~ \\
  \midrule
  
  \multirow{3}{0.3\textwidth}{Behaviour-Hiding Module} & Front-End Interface Module\\
  & API Layer Module\\
  & Data Schema and Storage Module\\
  & Data Visualization Module\\
  \midrule
  
  \multirow{4}{0.3\textwidth}{Software Decision Module} & NLP Query Processor \\
  & Data Processing Pipeline Module\\
  & Authentication and Access Control Module\\
  & Fault and Error Management Module\\
  \bottomrule
  
  \end{tabular}
  \caption{Module Hierarchy}
  \label{TblMH}
  \end{table}

\newpage
~\newpage

\section{MIS of M8: Authentication and Access Control Module} \label{Module 8}

\subsection{Module}

\par{The Authentication and Access Control Module is responsible for verifying 
user identities, assigning access roles, and ensuring scalable entry points for users 
that access the software through the web application or through our API clients.}

\subsection{Uses}

\par{This module interfaces with the following modules:}

\begin{itemize}
  \item{M4: API Layer Module}
  \item{M3: Front-End Interface Module}
\end{itemize}

\par{Additionally, this module will use external libraries, including 
FastAPI's OAuth2PasswordBearer, and JWT libraries for token generation, 
encryption, and validation.}

\subsection{Syntax}

\subsubsection{Exported Constants}

\par{N/A}

\subsubsection{Exported Access Programs}

\begin{center}
\begin{tabular}{p{4cm} p{4cm} p{4cm} p{4cm}}
\hline
\textbf{Name} & \textbf{In} & \textbf{Out} & \textbf{Exceptions} \\
\hline
Login User & String Username, String Password & String JWT Token & InvalidCredentialsError \\
Verify Token & String JWT Token & User Object & TokenExpiredError, InvalidTokenError \\
Get User & String JWT Token & User Object & Authentication Error \\
Authorize Role & User Object, String JWT Token & Boolean & AccessDeniedError \\
Logout User & String JWT Token & Boolean & InvalidTokenError \\
Refresh Token & String JWT Token & String JWT Token & InvalidTokenError, TokenExpiredError \\
\hline
\end{tabular}
\end{center}

\subsection{Semantics}

\subsubsection{State Variables}

\begin{itemize}
  \item{User Credentials: A HashMap of usernames to password hashes.}
  \item{Active Tokens: Dictionary of JWT Token Strings mapped to Expiry Timestamps.}
  \item{Permissions Mapping: Dictionary of Role Strings mapped to Permission Strings.}
\end{itemize}

\subsubsection{Environment Variables}

\begin{itemize}
  \item{JWT SECRET KEY: User key used for token signing and verification.}
  \item{MAX CONCURRENT USERS: Maximum allowed concurrent users.}
  \item{NUM CONCURRENT USERS: Number of current concurrent users.}
  \item{USER DATABASE URL: Connection URL to the credential and role management database.}
  \item{TOKEN EXPIRY: Token lifetime configuration for user session.}
\end{itemize}

\subsubsection{Assumptions}

\begin{itemize}
  \item{Authentication requests may orginiate concurrently from both UI or API clients.}
  \item{Passwords are stored securely using a one-way hash.}
  \item{HTTPS is enforced for all login and token exchange operations.}
\end{itemize}

\subsubsection{Access Routine Semantics}

\noindent loginUser():
\begin{itemize}
\item transition: Verifies credentials from userCredentials.
\item output: JWT Token as a String.
\item exception: InvalidCredentialsError.
\end{itemize}

\noindent verifyToken():
\begin{itemize}
\item transition: Checks JWT Token signature, expiry time, and status in activeTokens.
\item output: User Object if token is valid.
\item exception: InvalidTokenError or TokenExpiredError.
\end{itemize}

\noindent getUser():
\begin{itemize}
\item transition: None.
\item output: User Object.
\item exception: AuthenticationError.
\end{itemize}

\noindent authorizeRole():
\begin{itemize}
\item transition: None.
\item output: True if authorized, False otherwise.
\item exception: AccessDeniedError.
\end{itemize}

\noindent logoutUser():
\begin{itemize}
\item transition: Removes identifier from activeTokens, logging out the user.
\item output: True if successful, False otherwise.
\item exception: InvalidTokenError.
\end{itemize}

\noindent refreshToken():
\begin{itemize}
\item transition: Validates token and reissues a fresh JWT Token with renewed expiry time.
\item output: JWT Token as a String
\item exception: InvalidTokenError or TokenExpiredError.
\end{itemize}

\subsubsection{Local Functions}

\begin{itemize}
  \item{hashPassword(String password): Generates a secure hash of a user password.}
  \item{createJWTToken(User Object, int expiry): Generates a JWT Token containing user data and expiry period.}
  \item{decodeJWTToken(String JWTToken): Decodes and validates a JWT Token, extracting user data and expiry period.}
  \item{validateUser(String username, String password): Authenticates user via stored credentials.}
\end{itemize}

\newpage

\bibliographystyle {plainnat}
\bibliography {../../../refs/References}

\newpage

\section{Appendix} \label{Appendix}

\wss{Extra information if required}

\newpage{}

\section*{Appendix --- Reflection}

\wss{Not required for CAS 741 projects}

The information in this section will be used to evaluate the team members on the
graduate attribute of Problem Analysis and Design.

\input{../../Reflection.tex}

\begin{enumerate}
  \item What went well while writing this deliverable? 
  \item What pain points did you experience during this deliverable, and how
    did you resolve them?
  \item Which of your design decisions stemmed from speaking to your client(s)
  or a proxy (e.g. your peers, stakeholders, potential users)? For those that
  were not, why, and where did they come from?
  \item While creating the design doc, what parts of your other documents (e.g.
  requirements, hazard analysis, etc), it any, needed to be changed, and why?
  \item What are the limitations of your solution?  Put another way, given
  unlimited resources, what could you do to make the project better? (LO\_ProbSolutions)
  \item Give a brief overview of other design solutions you considered.  What
  are the benefits and tradeoffs of those other designs compared with the chosen
  design?  From all the potential options, why did you select the documented design?
  (LO\_Explores)
\end{enumerate}


\end{document}
